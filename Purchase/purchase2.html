<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pembelian Chapter | Simulasi Algoritma</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="purchase.css">
</head>
<body>

<header class="header">
  <h2>Digital Informatics Media</h2>
  <span>Pembelian Chapter – Simulasi Algoritma</span>
</header>

<main class="container">

<!-- ================= PILIH CHAPTER ================= -->
<section class="card">
  <h3>Chapter Simulasi Algoritma (Rp 9.000)</h3>

  <div class="product-grid">

    <label class="product-card">
      <input type="radio" name="product" value="Simulasi Algoritma - IF|9000" required>
      <div class="product-inner">
        <h4>Simulasi IF</h4>
        <p>Visualisasi pengkondisian satu kondisi</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

    <label class="product-card">
      <input type="radio" name="product" value="Simulasi Algoritma - IF ELSE|9000">
      <div class="product-inner">
        <h4>Simulasi IF – ELSE</h4>
        <p>Visualisasi percabangan dua kondisi</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

    <label class="product-card">
      <input type="radio" name="product" value="Simulasi Algoritma - Perulangan|9000">
      <div class="product-inner">
        <h4>Simulasi Perulangan</h4>
        <p>Simulasi FOR & WHILE langkah demi langkah</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

    <label class="product-card">
      <input type="radio" name="product" value="Simulasi Algoritma - Array|9000">
      <div class="product-inner">
        <h4>Simulasi Array</h4>
        <p>Visualisasi penyimpanan dan akses data</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

    <label class="product-card">
      <input type="radio" name="product" value="Simulasi Algoritma - Bubble Sort|9000">
      <div class="product-inner">
        <h4>Simulasi Bubble Sort</h4>
        <p>Animasi pertukaran elemen sorting</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

    <label class="product-card">
      <input type="radio" name="product" value="Simulasi Algoritma - Insertion Sort|9000">
      <div class="product-inner">
        <h4>Simulasi Insertion Sort</h4>
        <p>Animasi penyisipan elemen terurut</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

  </div>
</section>

<!-- ================= DATA PEMBELI ================= -->
<section class="card">
  <h3>Data Pembeli</h3>

  <div class="form-group">
    <input type="text" id="nama" placeholder="Nama Lengkap" required>
    <input type="email" id="email" placeholder="Email Aktif" required>
    <input type="text" id="whatsapp" placeholder="No WhatsApp (08xxx)" required>
  </div>

  <p class="order-id">
    Nomor Pesanan: <strong id="orderId"></strong>
  </p>
</section>

<!-- ================= METODE PEMBAYARAN ================= -->
<section class="card">
  <h3>Metode Pembayaran</h3>

  <div class="payment-methods">
    <button type="button" onclick="showPayment('qris')">QRIS</button>
    <button type="button" onclick="showPayment('ewallet')">E-Wallet</button>
    <button type="button" onclick="showPayment('bank')">Transfer Bank</button>
  </div>

  <div id="qris" class="payment-box">
    <h4>QRIS</h4>
    <img src="../img/qris.jpeg" class="qris-img">
  </div>

  <div id="ewallet" class="payment-box">
    <ul>
      <li>DANA : <strong>0812-xxxx-xxxx</strong></li>
      <li>OVO : <strong>0812-xxxx-xxxx</strong></li>
      <li>GoPay : <strong>0812-xxxx-xxxx</strong></li>
    </ul>
  </div>

  <div id="bank" class="payment-box">
    <ul>
      <li>BCA : <strong>1234567890</strong></li>
      <li>BRI : <strong>0987654321</strong></li>
      <li>Mandiri : <strong>1122334455</strong></li>
    </ul>
  </div>

  <div class="upload-box">
    <label>Upload Bukti Pembayaran</label>
    <input type="file" id="bukti" accept="image/*" required>
  </div>
</section>

<!-- ================= KONFIRMASI ================= -->
<section class="card confirm">
  <button class="confirm-btn" onclick="confirmPayment()">
    Konfirmasi via WhatsApp
  </button>
  <a href="../Dashboard/index.html" class="cancel-btn">Batal & Kembali</a>
</section>

</main>

<footer>© 2025 Digital Informatics Media</footer>

<script>
/* ================= ORDER ID ================= */
const orderId = "DIM-" + new Date().toISOString().replace(/[-:.TZ]/g,'');
document.getElementById("orderId").innerText = orderId;

/* ================= PAYMENT VIEW ================= */
function showPayment(id){
  document.querySelectorAll('.payment-box').forEach(el=>{
    el.style.display = 'none';
  });
  document.getElementById(id).style.display = 'block';
}

/* ================= KONFIRMASI PEMBAYARAN ================= */
function confirmPayment(){
  const product = document.querySelector('input[name="product"]:checked');
  const nama = document.getElementById("nama").value;
  const email = document.getElementById("email").value;
  const wa = document.getElementById("whatsapp").value;
  const bukti = document.getElementById("bukti").files.length;

  if(!product || !nama || !email || !wa || bukti === 0){
    alert("Lengkapi data dan upload bukti pembayaran");
    return;
  }

  // SIMPAN DATA USER (UNTUK PROFIL)
  localStorage.setItem("userName", nama);
  localStorage.setItem("userEmail", email);
  localStorage.setItem("userWhatsapp", wa);

  const [name, price] = product.value.split("|");

  const chapterMap = {
    "Simulasi Algoritma - IF": "sim_if",
    "Simulasi Algoritma - IF ELSE": "sim_ifelse",
    "Simulasi Algoritma - Perulangan": "sim_loop",
    "Simulasi Algoritma - Array": "sim_array",
    "Simulasi Algoritma - Bubble Sort": "sim_bubble",
    "Simulasi Algoritma - Insertion Sort": "sim_insertion"
  };

  let chapters = JSON.parse(localStorage.getItem("myChapters")) || [];
  const chapterId = chapterMap[name];

  if(chapterId && !chapters.includes(chapterId)){
    chapters.push(chapterId);
    localStorage.setItem("myChapters", JSON.stringify(chapters));
  }

  const message =
`Halo Admin Digital Informatics Media

Nama    : ${nama}
Email   : ${email}
WhatsApp: ${wa}
Order ID: ${orderId}

Chapter : ${name}
Harga   : Rp ${Number(price).toLocaleString("id-ID")}

Bukti pembayaran sudah saya upload.
Terima kasih.`;

  window.open(
    "https://wa.me/6281312194625?text=" + encodeURIComponent(message),
    "_blank"
  );

  alert("Chapter Simulasi berhasil ditambahkan ke akun kamu!");
}
</script>

</body>
</html>
