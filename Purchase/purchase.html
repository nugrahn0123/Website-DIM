<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pembelian Chapter | Digital Informatics Media</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="purchase.css">
</head>
<body>

<header class="header">
  <h2>Digital Informatics Media</h2>
  <span>Halaman Pembelian Chapter</span>
</header>

<main class="container">

<!-- ================= PILIH CHAPTER ================= -->
<section class="card">
  <h3>Pilih Chapter (Rp 9.000)</h3>

  <div class="product-grid">

    <label class="product-card">
      <input type="radio" name="product" value="Struktur Data - IF|9000" required>
      <div class="product-inner">
        <h4>IF (Pengkondisian Dasar)</h4>
        <p>Logika keputusan satu kondisi</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

    <label class="product-card">
      <input type="radio" name="product" value="Struktur Data - IF ELSE|9000">
      <div class="product-inner">
        <h4>IF – ELSE</h4>
        <p>Percabangan dua kondisi</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

    <label class="product-card">
      <input type="radio" name="product" value="Struktur Data - Perulangan|9000">
      <div class="product-inner">
        <h4>Perulangan FOR & WHILE</h4>
        <p>Pengulangan proses dalam algoritma</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

    <label class="product-card">
      <input type="radio" name="product" value="Struktur Data - Array|9000">
      <div class="product-inner">
        <h4>Array 1 Dimensi</h4>
        <p>Penyimpanan dan pengolahan data</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

    <label class="product-card">
      <input type="radio" name="product" value="Struktur Data - Bubble Sort|9000">
      <div class="product-inner">
        <h4>Bubble Sort</h4>
        <p>Algoritma pengurutan berbasis pertukaran</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

    <label class="product-card">
      <input type="radio" name="product" value="Struktur Data - Insertion Sort|9000">
      <div class="product-inner">
        <h4>Insertion Sort</h4>
        <p>Algoritma pengurutan berbasis penyisipan</p>
        <span class="price">Rp 9.000</span>
      </div>
    </label>

  </div>
</section>

<!-- ================= DATA PEMBELI ================= -->
<section class="card">
  <h3>Data Pembeli</h3>

  <div class="form-group">
    <input type="text" id="nama" placeholder="Nama Lengkap" required>
    <input type="email" id="email" placeholder="Email Aktif" required>
    <input type="text" id="whatsapp" placeholder="No WhatsApp (08xxx)" required>
  </div>

  <p class="order-id">
    Nomor Pesanan: <strong id="orderId"></strong>
  </p>
</section>

<!-- ================= METODE PEMBAYARAN ================= -->
<section class="card">
  <h3>Metode Pembayaran</h3>

  <div class="payment-methods">
    <button type="button" onclick="showPayment('qris')">QRIS</button>
    <button type="button" onclick="showPayment('ewallet')">E-Wallet</button>
    <button type="button" onclick="showPayment('bank')">Transfer Bank</button>
  </div>

  <div id="qris" class="payment-box">
    <h4>QRIS</h4>
    <p>Scan QR di bawah ini:</p>
    <img src="../img/qris.jpeg" alt="QRIS" class="qris-img">
  </div>

  <div id="ewallet" class="payment-box">
    <h4>E-Wallet</h4>
    <ul>
      <li>DANA : <strong>0812-xxxx-xxxx</strong></li>
      <li>OVO : <strong>0812-xxxx-xxxx</strong></li>
      <li>GoPay : <strong>0812-xxxx-xxxx</strong></li>
    </ul>
  </div>

  <div id="bank" class="payment-box">
    <h4>Transfer Bank</h4>
    <ul>
      <li>BCA : <strong>1234567890</strong></li>
      <li>BRI : <strong>0987654321</strong></li>
      <li>Mandiri : <strong>1122334455</strong></li>
    </ul>
  </div>

  <div class="upload-box">
    <label>Upload Bukti Pembayaran</label>
    <input type="file" id="bukti" accept="image/*" required>
  </div>
</section>

<!-- ================= KONFIRMASI ================= -->
<section class="card confirm">
  <button class="confirm-btn" onclick="confirmPayment()">
    Konfirmasi via WhatsApp
  </button>

  <a href="../Dashboard/index.html" class="cancel-btn">
    Batal & Kembali
  </a>
</section>

</main>

<footer>
  © 2025 Digital Informatics Media
</footer>

<script>
/* ================= ORDER ID ================= */
const orderId = "DIM-" + new Date().toISOString().replace(/[-:.TZ]/g,'');
document.getElementById("orderId").innerText = orderId;

/* ================= METODE PEMBAYARAN ================= */
function showPayment(id){
  document.querySelectorAll('.payment-box').forEach(el=>{
    el.style.display = 'none';
  });
  document.getElementById(id).style.display = 'block';
}

/* ================= KONFIRMASI PEMBAYARAN ================= */
function confirmPayment(){
  const product = document.querySelector('input[name="product"]:checked');
  const nama = document.getElementById("nama").value;
  const email = document.getElementById("email").value;
  const wa = document.getElementById("whatsapp").value;
  const bukti = document.getElementById("bukti").files.length;

  if(!product || !nama || !email || !wa){
    alert("Lengkapi data dan pilih chapter terlebih dahulu");
    return;
  }

  if(bukti === 0){
    alert("Silakan upload bukti pembayaran");
    return;
  }

  const [name, price] = product.value.split("|");

  const chapterMap = {
    "Struktur Data - IF": "if",
    "Struktur Data - IF ELSE": "ifelse",
    "Struktur Data - Perulangan": "loop",
    "Struktur Data - Array": "array",
    "Struktur Data - Bubble Sort": "bubble",
    "Struktur Data - Insertion Sort": "insertion"
  };

  const chapterId = chapterMap[name];
  let chapters = JSON.parse(localStorage.getItem("myChapters")) || [];

  if(chapterId && !chapters.includes(chapterId)){
    chapters.push(chapterId);
  }

  localStorage.setItem("myChapters", JSON.stringify(chapters));

  const message =
    "Halo Admin Digital Informatics Media\n\n" +
    "Nama    : " + nama + "\n" +
    "Email   : " + email + "\n" +
    "WhatsApp: " + wa + "\n" +
    "Order ID: " + orderId + "\n\n" +
    "Chapter : " + name + "\n" +
    "Harga   : Rp " + Number(price).toLocaleString("id-ID") + "\n\n" +
    "Bukti pembayaran sudah saya upload.\n" +
    "Terima kasih.";

  window.open(
    "https://wa.me/6281312194625?text=" + encodeURIComponent(message),
    "_blank"
  );

  alert("Chapter berhasil ditambahkan ke Dashboard!");
}
</script>

</body>
</html>
